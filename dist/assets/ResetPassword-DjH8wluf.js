import{f as B,u as F,o as I,j as e,b as E,a3 as H,r as m,ae as D,ad as N,D as q,ai as j,S as p,s as U,T as _,B as $,af as k,aj as S,ag as y,ak as G,al as C,ah as z,a9 as A,aa as P,am as O}from"./index-DK1BDKGD.js";import{u as V,H as b}from"./chunk-7OLJDQMT-DLU5gO0J.js";import{B as w}from"./chunk-UVUR7MCU-Dbi6v9Kw.js";import{C as Y}from"./chunk-CWVAJCXJ-DTRhzuvr.js";var f=B(function(a,t){const d=F("Link",a),{className:u,isExternal:l,...c}=I(a);return e.jsx(E.a,{target:l?"_blank":void 0,rel:l?"noopener":void 0,ref:t,className:H("chakra-link",u),...c,__css:d})});f.displayName="Link";const J=A().shape({password:P().min(8,"At least 8 words").required("Password is required"),confirm:P().oneOf([O("password"),null],"Passwords must match").required("Confirm your password")}),se=()=>{const[o,a]=m.useState({email:"",updated:!1,isLoading:!1,error:!1});m.useEffect(()=>{(async()=>{const L=new URLSearchParams(window.location.search).get("token"),g=G(L);try{let i=await C.post("http://localhost:5000/forgotpassword/checkvalidate",{email:g.email,token:g.token});i.status===400?a(h=>({...h,updated:!0,error:!0})):i.status===200&&a(h=>({...h,updated:!0,email:i.data.email}))}catch(i){console.error("Error:",i)}})()},[]);const[t,d]=m.useState(!1),u=()=>d(!t),l=D(),{register:c,handleSubmit:v,watch:x,formState:{errors:n,isValid:K},reset:M}=N({mode:"onSubmit",resolver:z(J)}),W=x("password");x("confirm");const r=V();q();const R=async T=>{try{let s=await C.post("http://localhost:5000/forgotpassword/reset",{email:o.email,password:W});s&&(s.status===200?(r({title:"Change password success",description:"You will soon be redirected",status:"success",duration:2e3}),setTimeout(()=>{window.location.href="/"},2e3)):s.status===402?r({title:"User does not exist",description:"Something Went Wrong",status:"error",duration:3e3}):s.status===401?r({title:"The new password is the same as the old password.",description:"Please use another password",status:"error",duration:3e3}):s.status===400&&r({title:"Something Went Wrong",status:"error",duration:3e3}))}catch(s){s.response&&(s.response.status===400?r({title:"Something Went Wrong",status:"error",duration:3e3}):s.response.status===401?r({title:"The new password is the same as the old password.",description:"Please use another password",status:"error",duration:3e3}):s.response.status===402&&r({title:"User does not exist",description:"Something Went Wrong",status:"error",duration:3e3}))}};if(o.updated===!0){if(o.error===!0)return e.jsx(j,{flexDirection:"column",width:"100wh",height:"100vh",backgroundColor:"gray.200",justifyContent:"center",alignItems:"center",children:e.jsxs(p,{direction:"column",marginBottom:"2",justifyContent:"center",alignItems:"center",children:[e.jsx(b,{color:"teal.400",children:"Problem resetting password"}),e.jsx("p",{children:"Reset link expire or invalid link"}),e.jsx("p",{children:"Please send another reset link"}),e.jsxs(U,{children:[e.jsx(w,{children:e.jsx(f,{href:"/",children:"Go Home"})}),e.jsx(w,{children:e.jsx(f,{href:"/forgotpassword",children:"Forgot Password"})})]})]})});if(o.email)return e.jsx(j,{flexDirection:"column",width:"100wh",height:"100vh",backgroundColor:"gray.200",justifyContent:"center",alignItems:"center",children:e.jsxs(p,{direction:"column",marginBottom:"2",justifyContent:"center",alignItems:"center",children:[e.jsx(b,{color:"teal.400",children:"Reset your password"}),e.jsx(_,{color:"teal.400",children:"Please enter new password"}),e.jsx($,{minW:{base:"90%",md:"468px"},children:e.jsx("form",{onSubmit:v(R),children:e.jsxs(p,{spacing:4,p:"1rem",backgroundColor:"white",boxShadow:"md",children:[e.jsx(k,{children:e.jsx(S,{children:e.jsx(y,{type:t?"text":"password",placeholder:"Password",...c("password")})})}),e.jsx(k,{children:e.jsx(S,{children:e.jsx(y,{type:t?"text":"password",placeholder:"Confirm Password",...c("confirm")})})}),n.password&&e.jsx("p",{children:n.password.message}),!n.password&&n.confirm&&e.jsx("p",{children:n.confirm.message}),l?e.jsx("p",{children:"Caps Lock is active!"}):null,e.jsx(Y,{size:"sm",isChecked:t,onChange:u,children:t?"Hide Password":"Show Password"}),e.jsx(w,{borderRadius:0,type:"submit",variant:"solid",colorScheme:"teal",width:"full",children:"Submit"})]})})})]})})}};export{se as default};
