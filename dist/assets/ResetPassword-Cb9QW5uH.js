import{f as B,u as F,o as I,j as e,b as E,a3 as H,r as m,ae as $,ad as q,D,ai as j,S as p,q as N,T as z,B as U,af as k,aj as S,ag as y,ak as _,al as C,ah as G,a9 as A,aa as P,am as O}from"./index-CSaA1nFA.js";import{u as V,H as b}from"./chunk-7OLJDQMT-B2iVonpa.js";import{B as w}from"./chunk-UVUR7MCU-jy_K_3Vu.js";import{C as Y}from"./chunk-CWVAJCXJ-Bu8JRnmM.js";var f=B(function(o,t){const l=F("Link",o),{className:u,isExternal:c,...d}=I(o);return e.jsx(E.a,{target:c?"_blank":void 0,rel:c?"noopener":void 0,ref:t,className:H("chakra-link",u),...d,__css:l})});f.displayName="Link";const J=A().shape({password:P().min(8,"At least 8 words").required("Password is required"),confirm:P().oneOf([O("password"),null],"Passwords must match").required("Confirm your password")}),se=()=>{const[a,o]=m.useState({email:"",updated:!1,isLoading:!1,error:!1});m.useEffect(()=>{(async()=>{const L=new URLSearchParams(window.location.search).get("token"),g=_(L);try{let i=await C.post("http://ec2-107-23-219-13.compute-1.amazonaws.com/forgotpassword/checkvalidate",{email:g.email,token:g.token});i.status===400?o(h=>({...h,updated:!0,error:!0})):i.status===200&&o(h=>({...h,updated:!0,email:i.data.email}))}catch(i){console.error("Error:",i)}})()},[]);const[t,l]=m.useState(!1),u=()=>l(!t),c=$(),{register:d,handleSubmit:v,watch:x,formState:{errors:n,isValid:K},reset:M}=q({mode:"onSubmit",resolver:G(J)}),W=x("password");x("confirm");const r=V();D();const R=async T=>{try{let s=await C.post("http://ec2-107-23-219-13.compute-1.amazonaws.com/forgotpassword/reset",{email:a.email,password:W});s&&(s.status===200?(r({title:"Change password success",description:"You will soon be redirected",status:"success",duration:2e3}),setTimeout(()=>{window.location.href="/"},2e3)):s.status===402?r({title:"User does not exist",description:"Something Went Wrong",status:"error",duration:3e3}):s.status===401?r({title:"The new password is the same as the old password.",description:"Please use another password",status:"error",duration:3e3}):s.status===400&&r({title:"Something Went Wrong",status:"error",duration:3e3}))}catch(s){s.response&&(s.response.status===400?r({title:"Something Went Wrong",status:"error",duration:3e3}):s.response.status===401?r({title:"The new password is the same as the old password.",description:"Please use another password",status:"error",duration:3e3}):s.response.status===402&&r({title:"User does not exist",description:"Something Went Wrong",status:"error",duration:3e3}))}};if(a.updated===!0){if(a.error===!0)return e.jsx(j,{flexDirection:"column",width:"100wh",height:"100vh",backgroundColor:"gray.200",justifyContent:"center",alignItems:"center",children:e.jsxs(p,{direction:"column",marginBottom:"2",justifyContent:"center",alignItems:"center",children:[e.jsx(b,{color:"teal.400",children:"Problem resetting password"}),e.jsx("p",{children:"Reset link expire or invalid link"}),e.jsx("p",{children:"Please send another reset link"}),e.jsxs(N,{children:[e.jsx(w,{children:e.jsx(f,{href:"/",children:"Go Home"})}),e.jsx(w,{children:e.jsx(f,{href:"/forgotpassword",children:"Forgot Password"})})]})]})});if(a.email)return e.jsx(j,{flexDirection:"column",width:"100wh",height:"100vh",backgroundColor:"gray.200",justifyContent:"center",alignItems:"center",children:e.jsxs(p,{direction:"column",marginBottom:"2",justifyContent:"center",alignItems:"center",children:[e.jsx(b,{color:"teal.400",children:"Reset your password"}),e.jsx(z,{color:"teal.400",children:"Please enter new password"}),e.jsx(U,{minW:{base:"90%",md:"468px"},children:e.jsx("form",{onSubmit:v(R),children:e.jsxs(p,{spacing:4,p:"1rem",backgroundColor:"white",boxShadow:"md",children:[e.jsx(k,{children:e.jsx(S,{children:e.jsx(y,{type:t?"text":"password",placeholder:"Password",...d("password")})})}),e.jsx(k,{children:e.jsx(S,{children:e.jsx(y,{type:t?"text":"password",placeholder:"Confirm Password",...d("confirm")})})}),n.password&&e.jsx("p",{children:n.password.message}),!n.password&&n.confirm&&e.jsx("p",{children:n.confirm.message}),c?e.jsx("p",{children:"Caps Lock is active!"}):null,e.jsx(Y,{size:"sm",isChecked:t,onChange:u,children:t?"Hide Password":"Show Password"}),e.jsx(w,{borderRadius:0,type:"submit",variant:"solid",colorScheme:"teal",width:"full",children:"Submit"})]})})})]})})}};export{se as default};
