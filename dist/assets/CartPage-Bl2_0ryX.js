import{j as e,B as s,y as G,r as S,z as K,D as Q,aC as _,V as j,S as J,a0 as X,v as A,T as y,q as p,ag as Z,aD as I,G as ee}from"./index-CSaA1nFA.js";import"./index-DVxGg5Dc.js";import{M as ae,a as te,b as re}from"./ModalsSystem-uwFOgr8A.js";import se from"./LoginRotate-ySgjwLn_.js";import{T,a as v,b as B,c as h,d as de,e as m}from"./chunk-MGVPL3OH-CeA--B3C.js";import{C as R}from"./chunk-CWVAJCXJ-Bu8JRnmM.js";import{B as u}from"./chunk-UVUR7MCU-jy_K_3Vu.js";import"./Signup-Cli2zUhA.js";import"./chunk-7OLJDQMT-B2iVonpa.js";import"./ForgotPassword-1eQZaqRk.js";const oe=({numItem:g})=>e.jsx(e.Fragment,{children:(()=>{switch(g){case 1:return e.jsxs(s,{textStyle:"StyledH2",color:"#000000",children:["Your Cart (",g," item)"]});default:return e.jsxs(s,{textStyle:"StyledH2",color:"#000000",children:["Your Cart (",g," items)"]})}})()}),f={orderImgWidth:"100"},ke=({initialInputValue:g,loading:W,error:L,fetchlike:le,imageWidth:ne})=>{const{isEmail:E}=G(),[P,O]=S.useState(g),{updateToken:z}=K(),C=Q(),{addPendingItems:H,finishPending:V,userInfo:$,setUserInfo:U,cartData:d,setCartData:k,setCheckoutLogin:w}=_(),x=(a,o)=>{O(r=>({...r,[a.strMeal]:o}))},q=a=>{const o=d.data.map(r=>({idMeal:r.idMeal,checked:r.checked,numMeal:r.numMeal}));i({items:o,isChecked:a})},M=S.useMemo(()=>d?!d.data.some(a=>!a.checked):!1,[d]),i=async({items:a,isChecked:o,value:r})=>{try{const c=(Array.isArray(a)?a:[a]).map(t=>({idMeal:t.idMeal,oldCheckedState:t.checked,newCheckedState:o,oldValue:Number(t.numMeal),newValue:r??t.numMeal}));c[0].newValue<=0&&k(t=>t&&{...t,data:t.data.filter(l=>l.idMeal!==c[0].idMeal)}),k(t=>t&&{...t,data:t.data.map(l=>{const b=c.find(F=>F.idMeal===l.idMeal);return b?{...l,checked:b.newCheckedState,numMeal:b.newValue}:l})}),H(c)}catch(n){console.error("Error updating check state:",n)}},N=async()=>{if(!d?.data?.some(a=>a.checked)){I.error(e.jsxs(j,{alignItems:"start",children:[e.jsx("div",{children:e.jsx("strong",{children:"Error"})}),e.jsx("div",{children:"Please select at least one item for checkout."})]}),{ariaLabel:"Email received",position:"bottom-center",autoClose:2e3,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"});return}try{Y()}catch(a){console.error("結帳前處理待處理項目失敗:",a),I.error(e.jsxs(j,{alignItems:"start",children:[e.jsx("div",{children:e.jsx("strong",{children:"Checkout failed."})}),e.jsx("div",{children:"Please try again later or contact customer service."})]}),{position:"bottom-center",autoClose:2e3,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}},Y=async()=>{try{await V(),C("/checkout?useDraft=false#deliver")}catch(a){console.log("error",a)}},D=async({token:a})=>{try{const o="http://ec2-107-23-219-13.compute-1.amazonaws.com/api/mergeCart",r={userInfo:$,token:a},n=await ee.post(o,r);n.status===200&&k(c=>c&&{...c,data:c.data.map(t=>{const l=n.data.result.data.find(b=>b.idMeal===t.idMeal);return l?{...t,numMeal:l.numMeal,cartAmount:l.cartAmount,checked:l.checked||!1}:t}),totalAmount:n.data.result.totalAmount,totalItem:n.data.result.totalItem,checkedAmount:n.data.result.checkedAmount,checkedItem:n.data.result.checkedItem}),setTimeout(()=>{z(),C("/checkout?useDraft=true#deliver"),w(!1)},2e3)}catch(o){o.code==="ECONNABORTED"||o.response}};return W?e.jsx(s,{children:"Loading..."}):L?e.jsx(s,{children:"Error Occurred"}):!d||d.data.length===0?e.jsx(s,{width:"100%",children:e.jsx(s,{textStyle:"StyledH2",color:"#000000",margin:"0 auto",width:"fit-content",children:"Your Cart is Empty"})}):e.jsxs(j,{width:"100%",children:[e.jsx(oe,{numItem:d.totalItem}),e.jsxs(J,{direction:{xl:"row",base:"column"},width:"100%",alignItems:"flex-start",spacing:6,children:[e.jsx(s,{width:{xl:"75%",base:"100%"},children:e.jsxs(T,{display:{md:"table",base:"block"},width:"100%",children:[e.jsx(v,{display:{md:"table-header-group",base:"none"},children:e.jsxs(B,{children:[e.jsx(h,{children:e.jsx(R,{isChecked:M,onChange:a=>q(!M)})}),e.jsx(h,{colSpan:3,children:"Item"}),e.jsx(h,{children:"Price"}),e.jsx(h,{children:"Quantity"}),e.jsx(h,{children:"Total"})]})}),e.jsx(de,{display:{md:"table-row-group",base:"block"},children:d.data.map((a,o)=>e.jsxs(B,{borderBottomWidth:"1px",display:{md:"table-row",base:"grid"},gridTemplateAreas:{md:"none",sm:`
                                "check img meal meal meal"
                                "check img price quantity total"
                                `,base:`
                                    "check img meal"
                                    "check price price"
                                    "check quantity quantity"
                                    "check total total"
                                `},children:[e.jsx(m,{colSpan:1,gridArea:"check",display:{md:"table-cell",base:"block"},paddingLeft:"0",paddingRight:"0",borderBottomWidth:{md:"1px",base:"0"},width:"1.5rem",children:e.jsx(s,{children:e.jsx(R,{isChecked:a.checked,onChange:r=>i({items:a,isChecked:r.target.checked,value:a.numMeal})},o)})}),e.jsx(m,{colSpan:1,gridArea:"img",display:{md:"table-cell",base:"block"},borderBottomWidth:{md:"1px",base:"0"},width:`${f.orderImgWidth}px`,padding:{md:"1.5rem",base:"0"},children:e.jsx(s,{width:`${f.orderImgWidth}px`,children:e.jsx(X,{src:a.strMealThumb,alt:a.strMeal,width:"auto",imgWidth:f.orderImgWidth,auto:"webp",height:`${f.orderImgWidth}px`,objectFit:"cover"})})}),e.jsxs(m,{colSpan:2,gridArea:"meal",display:{md:"table-cell",base:"flex"},flexDirection:"row",borderBottomWidth:{md:"1px",base:"0"},alignItems:"center",paddingLeft:"0",paddingRight:"0",children:[e.jsx(s,{textStyle:"StyledText",color:"#333333",children:a.strMeal}),e.jsx(u,{backgroundColor:"#e5e5e5",borderRadius:"50%",size:"xs",onClick:async()=>{await i({items:a,isChecked:a.checked,value:0}),x(a,0)},display:{md:"none",base:"block"},marginLeft:"1rem",children:e.jsx(A,{color:"#757575"})})]}),e.jsxs(m,{gridArea:"price",display:{md:"table-cell",base:"flex"},flexDirection:{md:"none",sm:"column",base:"row"},borderBottomWidth:{md:"1px",base:"0"},children:[e.jsx(y,{as:"span",display:{md:"none",base:"block"},marginRight:{md:"0",base:"1rem"},width:{sm:"100%",base:"33.33%"},align:{sm:"left",base:"right"},paddingLeft:"0",paddingRight:"0",children:"Price"}),e.jsxs(s,{children:["$",a.baseAmount]})]}),e.jsxs(m,{gridArea:"quantity",borderBottomWidth:{md:"1px",base:"0"},display:{md:"table-cell",base:"flex"},flexDirection:{md:"none",sm:"column",base:"row"},children:[e.jsx(y,{as:"span",display:{md:"none",base:"block"},marginRight:{md:"0",base:"1rem"},width:{sm:"100%",base:"33.33%"},align:{sm:"left",base:"right"},paddingLeft:"0",paddingRight:"0",children:"Quantity"}),e.jsxs(p,{children:[e.jsx(u,{backgroundColor:"#e5e5e5",borderRadius:"50%",fontSize:"1.5rem",size:"md",onClick:()=>{i({items:a,isChecked:a.checked,value:a.numMeal-1}),x(a,a.numMeal-1)},children:"-"}),e.jsx(Z,{maxWidth:"8vh",width:"8vh",textAlign:"center",value:P[a.strMeal],onChange:r=>{x(a,r.target.value)},onBlur:r=>i({items:a,isChecked:a.checked,value:Number(r.target.value)})}),e.jsx(u,{backgroundColor:"#e5e5e5",borderRadius:"50%",fontSize:"1.5rem",size:"md",onClick:()=>{i({items:a,isChecked:a.checked,value:a.numMeal+1}),x(a,a.numMeal+1)},children:"+"})]})]}),e.jsxs(m,{gridArea:"total",display:{md:"table-cell",base:"flex"},flexDirection:{md:"none",sm:"column",base:"row"},borderBottomWidth:{md:"1px",base:"0"},children:[e.jsx(y,{as:"span",display:{md:"none",base:"block"},marginRight:{md:"0",base:"1rem"},width:{sm:"100%",base:"33.33%"},align:{sm:"left",base:"right"},paddingLeft:"0",paddingRight:"0",children:"Total"}),e.jsxs(p,{justifyContent:{md:"right",base:"none"},children:[e.jsxs(s,{gridArea:"total",children:["$",a.cartAmount]}),e.jsx(u,{backgroundColor:"#e5e5e5",borderRadius:"50%",size:"xs",onClick:async()=>{await i({items:a,isChecked:a.checked,value:0}),x(a,0)},gridArea:"delete",display:{md:"block",base:"none"},children:e.jsx(A,{color:"#757575"})})]})]})]},o))})]})}),e.jsxs(s,{width:{xl:"25%",md:"50%",base:"100%"},children:[e.jsx(T,{children:e.jsxs(v,{children:[e.jsx(h,{children:"Order Summary"}),e.jsxs(h,{children:[d.checkedItem," ",d.checkedItem>1?"Items":"Item"]})]})}),e.jsxs(p,{justifyContent:"space-between",children:[e.jsx(s,{children:"Subtotal"}),e.jsxs(s,{children:["$",d.checkedAmount]})]}),e.jsxs(p,{justifyContent:"space-between",children:[e.jsx(s,{children:"Grand total"}),e.jsxs(s,{children:["$",d.checkedAmount]})]}),E?e.jsx(u,{color:"#ffffff",backgroundColor:"#da1a32",border:"1px solid #da1a32",width:"100%",marginTop:"1vh",_hover:{color:"#da1a32",backgroundColor:"#ffffff"},onClick:N,disabled:!d?.data?.some(a=>a.checked),children:"CHECKOUT"}):e.jsxs(ae,{id:"update",children:[e.jsx(te,{children:e.jsx(u,{color:"#ffffff",backgroundColor:"#da1a32",border:"1px solid #da1a32",width:"100%",marginTop:"1vh",_hover:{color:"#da1a32",backgroundColor:"#ffffff"},disabled:!d?.data?.some(a=>a.checked),children:"CHECKOUT"})}),e.jsx(re,{children:e.jsx(se,{onLoginSuccess:async a=>{w(!0),await U(o=>({...o,mergeCart:!0,accessToken:a})),await D({token:a})}})})]})]})]})]})};export{ke as default};
