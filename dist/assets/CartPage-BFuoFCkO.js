import{j as e,B as r,q as K,r as S,z as Q,aD as _,D as G,aC as J,V as j,S as X,a0 as Z,w as A,T as C,s as p,ag as ee,aE as T,J as ae}from"./index-DK1BDKGD.js";import"./index-DVxGg5Dc.js";import{M as se,a as te,b as re}from"./ModalsSystem-Du28IU22.js";import de from"./LoginRotate-PzgBvftE.js";import{T as I,a as v,b as B,c as h,d as oe,e as m}from"./chunk-MGVPL3OH-DbclQ4QU.js";import{C as R}from"./chunk-CWVAJCXJ-DTRhzuvr.js";import{B as u}from"./chunk-UVUR7MCU-Dbi6v9Kw.js";import"./Signup-B1VbTt7W.js";import"./chunk-7OLJDQMT-DLU5gO0J.js";import"./ForgotPassword-ChmNfcAN.js";const le=({numItem:g})=>e.jsx(e.Fragment,{children:(()=>{switch(g){case 1:return e.jsxs(r,{textStyle:"StyledH2",color:"#000000",children:["Your Cart (",g," item)"]});default:return e.jsxs(r,{textStyle:"StyledH2",color:"#000000",children:["Your Cart (",g," items)"]})}})()}),f={orderImgWidth:"100"},Ce=({initialInputValue:g,loading:L,error:W,fetchlike:ce,imageWidth:ne})=>{const{identifier:ie,isEmail:E}=K(),[P,O]=S.useState(g),{updateToken:H}=Q();_();const y=G(),{addPendingItems:V,finishPending:z,userInfo:U,setUserInfo:$,cartData:d,setCartData:k,setCheckoutLogin:w}=J(),x=(a,o)=>{O(s=>({...s,[a.strMeal]:o}))},q=a=>{const o=d.data.map(s=>({idMeal:s.idMeal,checked:s.checked,numMeal:s.numMeal}));console.log("click!",o),i({items:o,isChecked:a})},M=S.useMemo(()=>d?!d.data.some(a=>!a.checked):!1,[d]),i=async({items:a,isChecked:o,value:s})=>{try{const l=Array.isArray(a)?a:[a],c=l.map(t=>({idMeal:t.idMeal,oldCheckedState:t.checked,newCheckedState:o,oldValue:Number(t.numMeal),newValue:s??t.numMeal}));console.log(l,c,"itemsToUpdate",s,"value1",d,c[0].newValue<=0),c[0].newValue<=0&&k(t=>t&&{...t,data:t.data.filter(n=>n.idMeal!==c[0].idMeal)}),k(t=>t&&{...t,data:t.data.map(n=>{const b=c.find(F=>F.idMeal===n.idMeal);return b?{...n,checked:b.newCheckedState,numMeal:b.newValue}:n})}),V(c)}catch(l){console.error("Error updating check state:",l)}},N=async()=>{if(!d?.data?.some(a=>a.checked)){T.error(e.jsxs(j,{alignItems:"start",children:[e.jsx("div",{children:e.jsx("strong",{children:"Error"})}),e.jsx("div",{children:"Please select at least one item for checkout."})]}),{ariaLabel:"Email received",position:"bottom-center",autoClose:2e3,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"});return}try{Y()}catch(a){console.error("結帳前處理待處理項目失敗:",a),T.error(e.jsxs(j,{alignItems:"start",children:[e.jsx("div",{children:e.jsx("strong",{children:"Checkout failed."})}),e.jsx("div",{children:"Please try again later or contact customer service."})]}),{position:"bottom-center",autoClose:2e3,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})}},Y=async()=>{try{await z(),y("/checkout?useDraft=false#deliver")}catch(a){console.log("error",a)}},D=async({token:a})=>{try{console.log("mergeCart");const o="http://localhost:5000/api/mergeCart",s={userInfo:U,token:a},l=await ae.post(o,s);l.status===200&&k(c=>c&&{...c,data:c.data.map(t=>{const n=l.data.result.data.find(b=>b.idMeal===t.idMeal);return n?{...t,numMeal:n.numMeal,cartAmount:n.cartAmount,checked:n.checked||!1}:t}),totalAmount:l.data.result.totalAmount,totalItem:l.data.result.totalItem,checkedAmount:l.data.result.checkedAmount,checkedItem:l.data.result.checkedItem}),setTimeout(()=>{console.log("access token update complete"),H(),y("/checkout?useDraft=true#deliver"),w(!1)},2e3)}catch(o){o.code==="ECONNABORTED"||o.response}};return L?e.jsx(r,{children:"Loading..."}):W?e.jsx(r,{children:"Error Occurred"}):!d||d.data.length===0?e.jsx(r,{width:"100%",children:e.jsx(r,{textStyle:"StyledH2",color:"#000000",margin:"0 auto",width:"fit-content",children:"Your Cart is Empty"})}):e.jsxs(j,{width:"100%",children:[e.jsx(le,{numItem:d.totalItem}),e.jsxs(X,{direction:{xl:"row",base:"column"},width:"100%",alignItems:"flex-start",spacing:6,children:[e.jsx(r,{width:{xl:"75%",base:"100%"},children:e.jsxs(I,{display:{md:"table",base:"block"},width:"100%",children:[e.jsx(v,{display:{md:"table-header-group",base:"none"},children:e.jsxs(B,{children:[e.jsx(h,{children:e.jsx(R,{isChecked:M,onChange:a=>q(!M)})}),e.jsx(h,{colSpan:3,children:"Item"}),e.jsx(h,{children:"Price"}),e.jsx(h,{children:"Quantity"}),e.jsx(h,{children:"Total"})]})}),e.jsx(oe,{display:{md:"table-row-group",base:"block"},children:d.data.map((a,o)=>e.jsxs(B,{borderBottomWidth:"1px",display:{md:"table-row",base:"grid"},gridTemplateAreas:{md:"none",sm:`
                                "check img meal meal meal"
                                "check img price quantity total"
                                `,base:`
                                    "check img meal"
                                    "check price price"
                                    "check quantity quantity"
                                    "check total total"
                                `},children:[e.jsx(m,{colSpan:1,gridArea:"check",display:{md:"table-cell",base:"block"},paddingLeft:"0",paddingRight:"0",borderBottomWidth:{md:"1px",base:"0"},width:"1.5rem",children:e.jsx(r,{children:e.jsx(R,{isChecked:a.checked,onChange:s=>i({items:a,isChecked:s.target.checked,value:a.numMeal})},o)})}),e.jsx(m,{colSpan:1,gridArea:"img",display:{md:"table-cell",base:"block"},borderBottomWidth:{md:"1px",base:"0"},width:`${f.orderImgWidth}px`,padding:{md:"1.5rem",base:"0"},children:e.jsx(r,{width:`${f.orderImgWidth}px`,children:e.jsx(Z,{src:a.strMealThumb,alt:a.strMeal,width:"auto",imgWidth:f.orderImgWidth,auto:"webp",height:`${f.orderImgWidth}px`,objectFit:"cover"})})}),e.jsxs(m,{colSpan:2,gridArea:"meal",display:{md:"table-cell",base:"flex"},flexDirection:"row",borderBottomWidth:{md:"1px",base:"0"},alignItems:"center",paddingLeft:"0",paddingRight:"0",children:[e.jsx(r,{textStyle:"StyledText",color:"#333333",children:a.strMeal}),e.jsx(u,{backgroundColor:"#e5e5e5",borderRadius:"50%",size:"xs",onClick:async()=>{await i({items:a,isChecked:a.checked,value:0}),x(a,0)},display:{md:"none",base:"block"},marginLeft:"1rem",children:e.jsx(A,{color:"#757575"})})]}),e.jsxs(m,{gridArea:"price",display:{md:"table-cell",base:"flex"},flexDirection:{md:"none",sm:"column",base:"row"},borderBottomWidth:{md:"1px",base:"0"},children:[e.jsx(C,{as:"span",display:{md:"none",base:"block"},marginRight:{md:"0",base:"1rem"},width:{sm:"100%",base:"33.33%"},align:{sm:"left",base:"right"},paddingLeft:"0",paddingRight:"0",children:"Price"}),e.jsxs(r,{children:["$",a.baseAmount]})]}),e.jsxs(m,{gridArea:"quantity",borderBottomWidth:{md:"1px",base:"0"},display:{md:"table-cell",base:"flex"},flexDirection:{md:"none",sm:"column",base:"row"},children:[e.jsx(C,{as:"span",display:{md:"none",base:"block"},marginRight:{md:"0",base:"1rem"},width:{sm:"100%",base:"33.33%"},align:{sm:"left",base:"right"},paddingLeft:"0",paddingRight:"0",children:"Quantity"}),e.jsxs(p,{children:[e.jsx(u,{backgroundColor:"#e5e5e5",borderRadius:"50%",fontSize:"1.5rem",size:"md",onClick:()=>{i({items:a,isChecked:a.checked,value:a.numMeal-1}),x(a,a.numMeal-1)},children:"-"}),e.jsx(ee,{maxWidth:"8vh",width:"8vh",textAlign:"center",value:P[a.strMeal],onChange:s=>{x(a,s.target.value)},onBlur:s=>i({items:a,isChecked:a.checked,value:Number(s.target.value)})}),e.jsx(u,{backgroundColor:"#e5e5e5",borderRadius:"50%",fontSize:"1.5rem",size:"md",onClick:()=>{i({items:a,isChecked:a.checked,value:a.numMeal+1}),x(a,a.numMeal+1)},children:"+"})]})]}),e.jsxs(m,{gridArea:"total",display:{md:"table-cell",base:"flex"},flexDirection:{md:"none",sm:"column",base:"row"},borderBottomWidth:{md:"1px",base:"0"},children:[e.jsx(C,{as:"span",display:{md:"none",base:"block"},marginRight:{md:"0",base:"1rem"},width:{sm:"100%",base:"33.33%"},align:{sm:"left",base:"right"},paddingLeft:"0",paddingRight:"0",children:"Total"}),e.jsxs(p,{justifyContent:{md:"right",base:"none"},children:[e.jsxs(r,{gridArea:"total",children:["$",a.cartAmount]}),e.jsx(u,{backgroundColor:"#e5e5e5",borderRadius:"50%",size:"xs",onClick:async()=>{await i({items:a,isChecked:a.checked,value:0}),x(a,0)},gridArea:"delete",display:{md:"block",base:"none"},children:e.jsx(A,{color:"#757575"})})]})]})]},o))})]})}),e.jsxs(r,{width:{xl:"25%",md:"50%",base:"100%"},children:[e.jsx(I,{children:e.jsxs(v,{children:[e.jsx(h,{children:"Order Summary"}),e.jsxs(h,{children:[d.checkedItem," ",d.checkedItem>1?"Items":"Item"]})]})}),e.jsxs(p,{justifyContent:"space-between",children:[e.jsx(r,{children:"Subtotal"}),e.jsxs(r,{children:["$",d.checkedAmount]})]}),e.jsxs(p,{justifyContent:"space-between",children:[e.jsx(r,{children:"Grand total"}),e.jsxs(r,{children:["$",d.checkedAmount]})]}),E?e.jsx(u,{color:"#ffffff",backgroundColor:"#da1a32",border:"1px solid #da1a32",width:"100%",marginTop:"1vh",_hover:{color:"#da1a32",backgroundColor:"#ffffff"},onClick:N,disabled:!d?.data?.some(a=>a.checked),children:"CHECKOUT"}):e.jsxs(se,{id:"update",children:[e.jsx(te,{children:e.jsx(u,{color:"#ffffff",backgroundColor:"#da1a32",border:"1px solid #da1a32",width:"100%",marginTop:"1vh",_hover:{color:"#da1a32",backgroundColor:"#ffffff"},disabled:!d?.data?.some(a=>a.checked),children:"CHECKOUT"})}),e.jsx(re,{children:e.jsx(de,{onLoginSuccess:async a=>{w(!0),console.log("login success!!!! onLoginSuccess",a),await $(o=>({...o,mergeCart:!0,accessToken:a})),console.log("mergecart start"),await D({token:a}),console.log("mergecart end")}})})]})]})]})]})};export{Ce as default};
