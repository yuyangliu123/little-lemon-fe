import{f as S,a3 as B,j as e,aG as U,b as $,r as l,q as K,z as V,ae as X,D as Y,aD as J,M as Q,a9 as Z,aa as C,ad as ee,ah as te,G as se,S as T,B as p,af as L,aj as R,ag as N,s as _,aH as ae,al as oe,aI as ne,K as re}from"./index-DK1BDKGD.js";import{u as le,a as F}from"./ModalsSystem-Du28IU22.js";import ie from"./Signup-B1VbTt7W.js";import ce from"./ForgotPassword-ChmNfcAN.js";import{u as ue,H as de}from"./chunk-7OLJDQMT-DLU5gO0J.js";import{B as M}from"./chunk-UVUR7MCU-Dbi6v9Kw.js";import"./chunk-CWVAJCXJ-DTRhzuvr.js";var me=$("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),x=S(function(a,r){var o,n;const{placement:i="left",...v}=a,m=U(),t=m.field,f={[i==="left"?"insetStart":"insetEnd"]:"0",width:(o=t?.height)!=null?o:t?.h,height:(n=t?.height)!=null?n:t?.h,fontSize:t?.fontSize,...m.element};return e.jsx(me,{ref:r,__css:f,...v})});x.id="InputElement";x.displayName="InputElement";var P=S(function(a,r){const{className:o,...n}=a,i=B("chakra-input__left-element",o);return e.jsx(x,{ref:r,placement:"left",className:i,...n})});P.id="InputLeftElement";P.displayName="InputLeftElement";var w=S(function(a,r){const{className:o,...n}=a,i=B("chakra-input__right-element",o);return e.jsx(x,{ref:r,placement:"right",className:i,...n})});w.id="InputRightElement";w.displayName="InputRightElement";const be=({onLoginSuccess:d})=>{const[a,r]=l.useState(!1),[o,n]=l.useState(""),{lname:i,email:v,availableAccessToken:m,accessToken:t,isEmail:z}=K(),{updateToken:f}=V(),{closeModal:H}=le(),G=X();Y(),J();const{modalOpen:pe,setModalOpen:he,setLoadSignup:xe,setLoadForgotPass:fe}=l.useContext(Q),q=Z().shape({email:C().required("Please enter your email"),password:C().required("Please enter your password")});l.useEffect(()=>{console.log(m,"availableAccessToken test")},[m]);const{register:k,handleSubmit:A,watch:W,formState:{errors:y,isValid:ge}}=ee({mode:"onSubmit",resolver:te(q)}),E=W("email"),D=()=>r(!a),g=ue(),I=l.useRef();l.useEffect(()=>{const j=setTimeout(()=>{const c=[I],s=[E];c.forEach((u,h)=>{u.current&&u.current.value!==s[h]&&(u.current.value=s[h])})},100);return()=>clearTimeout(j)},[E]);const O=async j=>{try{const c={...j},s=await oe.post("http://localhost:5000/login/login",c,{withCredentials:!0,headers:{"Content-Type":"application/json"}});if(s.status===200){const u=s.data;localStorage.setItem("accessToken",u.accessToken);const h=ne();re.set("X-CSRF-Token",h,{secure:!0,sameSite:"strict"}),g({title:"Login Success",description:"You will soon be redirected",status:"success",duration:2e3});const b=await f();H(),console.log(b.availableAccessToken,b,"availableAccessToken test1"),d&&d({token:u.accessToken})}else s.status===400&&(n(s.statusText),g({title:"Login Failed",description:"Something Went Wrong",status:"error",duration:2e3}))}catch(c){const s=c.response?.data?.message||"Login Failed";n(s),g({title:"Login Failed",description:s,status:"error",duration:2e3}),console.log("Error:",c)}},{setModalState:je}=l.useContext(se);return e.jsxs(e.Fragment,{children:[e.jsxs(T,{direction:"column",marginBottom:"2",justifyContent:"center",alignItems:"center",children:[e.jsx(de,{color:"teal.400",children:"Welcome"}),e.jsx(p,{minW:{base:"90%",md:"468px"},children:e.jsx("form",{onSubmit:A(O),children:e.jsxs(T,{spacing:4,p:"1rem",backgroundColor:"white",boxShadow:"md",children:[e.jsx(L,{children:e.jsx(R,{children:e.jsx(N,{type:"email",placeholder:"email address",ref:I,...k("email")})})}),e.jsxs(L,{children:[e.jsxs(R,{children:[e.jsx(N,{type:a?"text":"password",placeholder:"Password",...k("password")}),e.jsx(w,{width:"4.5rem",children:e.jsx(M,{h:"1.75rem",size:"sm",onClick:D,children:a?"Hide":"Show"})})]}),e.jsxs(_,{width:"100%",justifyContent:"space-between",textStyle:"StyledText",fontSize:"1rem",color:"#000000",children:[e.jsxs(p,{children:[y.password&&e.jsx("p",{children:y.password.message}),o&&e.jsx("p",{children:o}),G&&e.jsx("p",{children:"Caps Lock is active!"})]}),e.jsx(p,{justifyContent:"end",children:e.jsx(ae,{children:e.jsx(F,{nest:!0,targetContent:e.jsx(ce,{}),children:"forgot password?"})})})]})]}),e.jsx(M,{borderRadius:0,type:"submit",variant:"solid",colorScheme:"teal",width:"full",children:"Login"})]})})})]}),e.jsx(p,{children:e.jsxs(_,{width:"fit-content",margin:"auto",children:[e.jsxs(p,{children:["New to us?"," "]}),e.jsx(F,{color:"teal.500",nest:!0,targetContent:e.jsx(ie,{}),children:"Signup"})]})})]})};export{be as default};
